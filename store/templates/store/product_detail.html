{% extends 'store/base.html' %}

{% block title %}{{ product.name }} - Sulthan Fragrance{% endblock %}

{% block extra_css %}
<style>
    .product-detail {
        background: transparent;
        padding: 90px 0 60px;
        min-height: calc(100vh - 60px);
    }

    .product-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
        display: grid;
        grid-template-columns: 45% 50%;
        gap: 5%;
        align-items: start;
    }

    /* Breadcrumb */
    .breadcrumb {
        display: flex;
        gap: 8px;
        align-items: center;
        font-size: 13px;
        color: var(--text-muted);
        padding: 0 20px;
        max-width: 1400px;
        margin: 0 auto 24px;
    }

    .breadcrumb a {
        color: var(--warm-amber);
        text-decoration: none;
        transition: opacity 0.2s;
    }

    .breadcrumb a:hover {
        opacity: 0.7;
        color: var(--primary);
    }

    /* Product Gallery */
    .product-gallery {
        position: relative;
    }

    .main-image-container {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid var(--border);
        padding: 20px;
    }

    .main-image {
        width: 100%;
        height: 500px;
        object-fit: contain;
        cursor: zoom-in;
        transition: transform 0.3s ease;
        background: white;
    }

    .main-image.zoomed {
        cursor: zoom-out;
        transform: scale(1.5);
    }

    .image-actions {
        display: flex;
        gap: 12px;
        margin-top: 16px;
        justify-content: center;
        align-items: center;
    }

    .image-action-btn {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        background: white;
        border: 1px solid var(--border);
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--warm-amber);
        box-shadow: var(--shadow-sm);
        font-size: 16px;
    }

    .image-action-btn:hover {
        background: var(--warm-amber);
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
        color: white;
        border-color: var(--warm-amber);
    }

    .image-action-btn:active {
        transform: translateY(0);
    }

    /* Product Info */
    .product-info-section {
        animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .product-header {
        background: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .badge-container {
        display: flex;
        gap: 8px;
        margin-bottom: 16px;
        flex-wrap: wrap;
    }

    .ios-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: #f8f8f8;
        color: var(--text-main);
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        border: 1px solid var(--border);
    }

    .ios-badge.category {
        background: #f8f8f8;
        color: var(--warm-amber);
        border: 1px solid var(--border);
    }

    .ios-badge.origin {
        background: #f8f8f8;
        color: var(--warm-amber);
        border: 1px solid var(--border);
    }

    .product-title {
        font-size: 32px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 12px;
        line-height: 1.2;
        letter-spacing: -0.5px;
    }

    .product-short-desc {
        font-size: 16px;
        color: var(--text-muted);
        line-height: 1.5;
        margin: 0;
    }

    /* Rating */
    .rating-section {
        background: white;
        padding: 16px 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        gap: 16px;
    }

    .rating-stars {
        display: flex;
        gap: 4px;
        color: #d4af37;
        font-size: 18px;
    }

    .rating-text {
        font-size: 14px;
        color: var(--text-muted);
    }

    /* Price Card */
    .price-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .price-row {
        display: flex;
        align-items: baseline;
        gap: 12px;
        margin-bottom: 8px;
    }

    .price {
        font-size: 36px;
        font-weight: 700;
        color: var(--primary);
    }

    .price-off {
        font-size: 16px;
        color: #2d8659;
        font-weight: 600;
    }

    .price-meta {
        font-size: 13px;
        color: var(--text-muted);
    }

    /* Trust Indicators */
    .trust-indicators {
        background: white;
        padding: 16px 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .trust-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
    }

    .trust-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        text-align: center;
    }

    .trust-icon {
        width: 36px;
        height: 36px;
        background: transparent;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--warm-amber);
        font-size: 20px;
    }

    .trust-text {
        font-size: 11px;
        color: var(--text-main);
        font-weight: 600;
        line-height: 1.3;
    }

    /* Variant Selection */
    .variant-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .section-label {
        font-size: 15px;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 12px;
        display: block;
    }

    .variant-options {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .variant-btn {
        padding: 12px 20px;
        border-radius: 12px;
        border: 2px solid var(--border);
        background: white;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        font-weight: 600;
        color: var(--text-main);
        font-size: 14px;
    }

    .variant-btn:hover {
        border-color: var(--warm-amber);
        transform: translateY(-2px);
    }

    .variant-btn.active {
        background: var(--warm-amber);
        border-color: var(--warm-amber);
        color: white;
        box-shadow: 0 4px 12px rgba(196, 111, 68, 0.3);
    }

    /* Delivery Info Card */
    .delivery-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .delivery-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
    }

    .delivery-item:last-child {
        border-bottom: none;
    }

    .delivery-icon {
        width: 40px;
        height: 40px;
        background: transparent;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--warm-amber);
        font-size: 20px;
        flex-shrink: 0;
    }

    .delivery-content {
        flex: 1;
    }

    .delivery-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 4px;
    }

    .delivery-desc {
        font-size: 13px;
        color: var(--text-muted);
    }

    /* Quantity Selector */
    .quantity-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .quantity-selector {
        display: inline-flex;
        align-items: center;
        gap: 20px;
        background: white;
        border-radius: 14px;
        padding: 8px 12px;
        border: 1px solid var(--border);
    }

    .qty-btn {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        border: none;
        background: white;
        color: var(--warm-amber);
        font-size: 20px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .qty-btn:hover:not(:disabled) {
        background: var(--warm-amber);
        color: white;
        transform: scale(1.1);
    }

    .qty-btn:active:not(:disabled) {
        transform: scale(0.95);
    }

    .qty-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .qty-value {
        min-width: 40px;
        text-align: center;
        font-size: 18px;
        font-weight: 700;
        color: var(--primary);
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        gap: 12px;
        margin-bottom: 16px;
    }

    .btn-add-cart,
    .btn-buy-now {
        flex: 1;
        padding: 16px 24px;
        font-size: 16px;
        font-weight: 600;
        border-radius: 14px;
        border: none;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--shadow-sm);
        position: relative;
        overflow: hidden;
    }

    .btn-add-cart {
        background: var(--warm-amber);
        color: white;
    }

    .btn-buy-now {
        background: white;
        color: var(--warm-amber);
        border: 2px solid var(--warm-amber);
    }

    .btn-add-cart:hover,
    .btn-buy-now:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-md);
    }

    .btn-add-cart:active,
    .btn-buy-now:active {
        transform: translateY(0);
    }

    /* Product Highlights */
    .highlights-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 12px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .highlights-grid {
        display: grid;
        gap: 12px;
    }

    .highlight-item {
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .highlight-icon {
        width: 36px;
        height: 36px;
        background: transparent;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--warm-amber);
        font-size: 18px;
        flex-shrink: 0;
    }

    .highlight-content {
        flex: 1;
    }

    .highlight-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 4px;
    }

    .highlight-desc {
        font-size: 13px;
        color: var(--text-muted);
        line-height: 1.4;
    }

    /* Description Card */
    .description-card {
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .description-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 16px;
    }

    .description-text {
        color: var(--text-muted);
        line-height: 1.7;
        font-size: 15px;
    }

    /* Related Products */
    .related-section {
        padding: 40px 20px 60px;
        max-width: 1400px;
        margin: 0 auto;
        background: transparent;
    }

    .related-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
    }

    .related-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--primary);
    }

    .related-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 16px;
    }

    .related-card {
        background: white;
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        box-shadow: var(--shadow-sm);
        border: 1px solid var(--border);
    }

    .related-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
    }

    .related-image {
        width: 100%;
        height: 220px;
        object-fit: contain;
        background: white;
        padding: 20px;
    }

    .related-info {
        padding: 16px;
        background: white;
    }

    .related-name {
        font-size: 15px;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 8px;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .related-price {
        font-size: 18px;
        color: var(--warm-amber);
        font-weight: 700;
    }

    /* Mobile Cart Bar - Hidden */
    .mobile-cart-bar {
        display: none !important;
    }

    /* Animations */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideInUp {
        from {
            transform: translateY(100%);
        }
        to {
            transform: translateY(0);
        }
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .product-container {
            grid-template-columns: 1fr;
            gap: 24px;
        }

        .main-image {
            height: 450px;
        }

        .trust-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (max-width: 768px) {
        .product-detail {
            padding: 10px 0 60px;
        }

        .breadcrumb {
            padding: 0 16px;
            margin-bottom: 16px;
        }

        .product-container {
            padding: 0 16px;
            gap: 20px;
        }

        .main-image-container {
            padding: 16px;
        }

        .product-header,
        .rating-section,
        .price-card,
        .trust-indicators,
        .variant-card,
        .delivery-card,
        .quantity-card,
        .highlights-card,
        .description-card {
            padding: 16px;
            margin-bottom: 12px;
        }

        .product-title {
            font-size: 24px;
        }

        .main-image {
            height: 350px;
        }

        .price {
            font-size: 30px;
        }

        .action-buttons {
            flex-direction: row;
            gap: 12px;
        }

        .btn-add-cart,
        .btn-buy-now {
            flex: 1;
        }

        .related-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .related-image {
            height: 180px;
        }

        .trust-grid {
            gap: 10px;
        }
        
        .trust-icon {
            font-size: 18px;
            width: 32px;
            height: 32px;
        }

        .trust-text {
            font-size: 10px;
        }
        
        .delivery-item {
            padding: 10px 0;
        }
        
        .delivery-icon {
            width: 36px;
            height: 36px;
            font-size: 18px;
        }

        .image-actions {
            gap: 10px;
            margin-top: 12px;
        }

        .image-action-btn {
            width: 40px;
            height: 40px;
            font-size: 14px;
        }
    }

    @media (max-width: 480px) {
        .product-title {
            font-size: 20px;
        }

        .main-image {
            height: 280px;
        }

        .related-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Loading Skeleton */
    .skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
    }

    @keyframes loading {
        0% {
            background-position: 200% 0;
        }
        100% {
            background-position: -200% 0;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Breadcrumb -->
<div class="breadcrumb">
    <a href="{% url 'store:home' %}">Home</a>
    <span>›</span>
    {% if product.category %}
    <a href="{% url 'store:home' %}?category={{ product.category.slug }}#products">{{ product.category.name }}</a>
    <span>›</span>
    {% endif %}
    <span>{{ product.name }}</span>
</div>

<section class="product-detail">
    <div class="product-container">
        <!-- Left: Product Gallery -->
        <div class="product-gallery">
            <div class="main-image-container">
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="main-image" id="mainImage">
            </div>
            <div class="image-actions">
                <button class="image-action-btn" onclick="zoomImage()" title="Zoom Image">
                    <i class="fa-solid fa-magnifying-glass-plus"></i>
                </button>
                <button class="image-action-btn" onclick="shareProduct()" title="Share Product">
                    <i class="fa-solid fa-share-nodes"></i>
                </button>
            </div>
        </div>

        <!-- Right: Product Information -->
        <div class="product-info-section">
            <!-- Product Header -->
            <div class="product-header">
                <div class="badge-container">
                    {% if product.category %}
                    <span class="ios-badge category">
                        <i class="fa-solid fa-layer-group"></i>{{ product.category.name }}
                    </span>
                    {% endif %}
                    <span class="ios-badge origin">
                        <i class="fa-solid fa-globe"></i>{{ product.get_origin_display }}
                    </span>
                </div>
                <h1 class="product-title">{{ product.name }}</h1>
                <p class="product-short-desc">{{ product.short_description }}</p>
            </div>

            <!-- Rating Section (Placeholder) -->
            <div class="rating-section">
                <div class="rating-stars">
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star"></i>
                    <i class="fa-solid fa-star-half-stroke"></i>
                </div>
                <span class="rating-text">4.5/5 • 128 reviews</span>
            </div>

            <!-- Price Card -->
            <div class="price-card">
                <div class="price-row">
                    <div class="price" id="priceDisplay">₹{{ product.default_variant_price }}</div>
                    <div class="price-off"><i class="fa-solid fa-tag" style="margin-right: 4px;"></i>20% OFF</div>
                </div>
                <div class="price-meta" id="variantMeta">
                    {% with default_variant=product.default_variant %}
                        {% if default_variant %}
                            {{ default_variant.ml }}ml • Inclusive of all taxes • Free Delivery
                        {% else %}
                            Inclusive of all taxes • Free Delivery
                        {% endif %}
                    {% endwith %}
                </div>
            </div>

            <!-- Trust Indicators -->
            <div class="trust-indicators">
                <div class="trust-grid">
                    <div class="trust-item">
                        <div class="trust-icon">
                            <i class="fa-solid fa-certificate"></i>
                        </div>
                        <div class="trust-text">100% Authentic</div>
                    </div>
                    <div class="trust-item">
                        <div class="trust-icon">
                            <i class="fa-solid fa-rotate-left"></i>
                        </div>
                        <div class="trust-text">Easy Returns</div>
                    </div>
                    <div class="trust-item">
                        <div class="trust-icon">
                            <i class="fa-solid fa-shield-halved"></i>
                        </div>
                        <div class="trust-text">Secure Payment</div>
                    </div>
                </div>
            </div>

            <!-- Variant Selection -->
            <div class="variant-card">
                <label class="section-label"><i class="fa-solid fa-flask" style="margin-right: 6px;"></i>Select Size</label>
                <div class="variant-options">
                    {% for variant in product.variants.all %}
                        <button class="variant-btn {% if forloop.first %}active{% endif %}" data-variant-id="{{ variant.id }}" data-price="{{ variant.price }}" data-ml="{{ variant.ml }}">
                            {{ variant.ml }}ml • ₹{{ variant.price }}
                        </button>
                    {% empty %}
                        <span class="variant-btn active">Standard Size</span>
                    {% endfor %}
                </div>
            </div>

            <!-- Delivery Information -->
            <div class="delivery-card">
                <label class="section-label"><i class="fa-solid fa-box" style="margin-right: 6px;"></i>Delivery & Services</label>
                <div class="delivery-item">
                    <div class="delivery-icon">
                        <i class="fa-solid fa-truck"></i>
                    </div>
                    <div class="delivery-content">
                        <div class="delivery-title">Free Delivery</div>
                        <div class="delivery-desc">Delivered in 3-5 business days</div>
                    </div>
                </div>
                <div class="delivery-item">
                    <div class="delivery-icon">
                        <i class="fa-solid fa-money-bill-wave"></i>
                    </div>
                    <div class="delivery-content">
                        <div class="delivery-title">Cash on Delivery</div>
                        <div class="delivery-desc">Pay when you receive your order</div>
                    </div>
                </div>
                <div class="delivery-item">
                    <div class="delivery-icon">
                        <i class="fa-solid fa-headset"></i>
                    </div>
                    <div class="delivery-content">
                        <div class="delivery-title">24/7 Support</div>
                        <div class="delivery-desc">We're here to help you anytime</div>
                    </div>
                </div>
            </div>

            <!-- Quantity Selection -->
            <div class="quantity-card">
                <label class="section-label"><i class="fa-solid fa-hashtag" style="margin-right: 6px;"></i>Quantity</label>
                <div class="quantity-selector">
                    <button class="qty-btn" onclick="decreaseQty()" id="decreaseBtn">−</button>
                    <span class="qty-value" id="quantity">1</span>
                    <button class="qty-btn" onclick="increaseQty()">+</button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn-add-cart" onclick="addToCart()">
                    <i class="fa-solid fa-bag-shopping" style="margin-right: 8px;"></i>Add to Cart
                </button>
                <button class="btn-buy-now" onclick="buyNow()">
                    <i class="fa-solid fa-cart-shopping" style="margin-right: 8px;"></i>Buy Now
                </button>
            </div>

            <!-- Product Highlights -->
            <div class="highlights-card">
                <label class="section-label"><i class="fa-solid fa-star" style="margin-right: 6px;"></i>Product Highlights</label>
                <div class="highlights-grid">
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fa-solid fa-spa"></i>
                        </div>
                        <div class="highlight-content">
                            <div class="highlight-title">Fragrance Notes</div>
                            <div class="highlight-desc">{{ product.fragrance_notes }}</div>
                        </div>
                    </div>
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fa-solid fa-hourglass-half"></i>
                        </div>
                        <div class="highlight-content">
                            <div class="highlight-title">Long Lasting</div>
                            <div class="highlight-desc">Stays fresh for 6-8 hours</div>
                        </div>
                    </div>
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fa-solid fa-seedling"></i>
                        </div>
                        <div class="highlight-content">
                            <div class="highlight-title">Non-Alcoholic</div>
                            <div class="highlight-desc">Safe for all skin types, alcohol-free formula</div>
                        </div>
                    </div>
                    <div class="highlight-item">
                        <div class="highlight-icon">
                            <i class="fa-solid fa-award"></i>
                        </div>
                        <div class="highlight-content">
                            <div class="highlight-title">Authentic {{ product.get_origin_display }}</div>
                            <div class="highlight-desc">Imported directly from source</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Description -->
            <div class="description-card">
                <h3 class="description-title"><i class="fa-solid fa-circle-info" style="margin-right: 8px;"></i>About This Fragrance</h3>
                <p class="description-text">{{ product.full_description }}</p>
            </div>
        </div>
    </div>
</section>

<!-- Related Products -->
{% if related_products %}
<section class="related-section">
    <div class="related-header">
        <h2 class="related-title"><i class="fa-solid fa-heart" style="margin-right: 10px; color: var(--warm-amber);"></i>You May Also Like</h2>
    </div>
    <div class="related-grid">
        {% for related in related_products %}
        <div class="related-card" onclick="window.location.href='{% url 'store:product_detail' related.slug %}'">
            <img src="{{ related.image.url }}" alt="{{ related.name }}" class="related-image" loading="lazy">
            <div class="related-info">
                <div class="related-name">{{ related.name }}</div>
                {% with related_variant=related.variants.all|first %}
                    <div class="related-price">
                        ₹{{ related_variant.price|default:related.price }}
                        {% if related_variant %}
                        <span style="font-size: 13px; color: var(--text-muted); font-weight: 500;"> • {{ related_variant.ml }}ml</span>
                        {% endif %}
                    </div>
                {% endwith %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    let quantity = 1;
    const productData = {
        id: '{{ product.id }}',
        name: '{{ product.name|escapejs }}',
        basePrice: parseFloat('{{ product.default_variant_price }}'),
        image: '{{ product.image.url }}',
        variants: [
            {% for variant in product.variants.all %}
                { id: '{{ variant.id }}', ml: {{ variant.ml }}, price: parseFloat('{{ variant.price }}') }{% if not forloop.last %},{% endif %}
            {% endfor %}
        ]
    };
    let selectedVariant = productData.variants[0] || null;
    let isImageZoomed = false;

    // Quantity Controls
    function updateQuantityDisplay() {
        document.getElementById('quantity').textContent = quantity;
        document.getElementById('decreaseBtn').disabled = quantity <= 1;
    }

    function increaseQty() {
        quantity++;
        updateQuantityDisplay();
    }

    function decreaseQty() {
        if (quantity > 1) {
            quantity--;
            updateQuantityDisplay();
        }
    }

    // Image Zoom Function
    function zoomImage() {
        const mainImage = document.getElementById('mainImage');
        isImageZoomed = !isImageZoomed;
        
        if (isImageZoomed) {
            mainImage.classList.add('zoomed');
        } else {
            mainImage.classList.remove('zoomed');
        }
    }

    // Share Product Function
    function shareProduct() {
        if (navigator.share) {
            navigator.share({
                title: productData.name,
                text: 'Check out this amazing fragrance!',
                url: window.location.href
            }).then(() => {
                showIOSNotification('Product shared successfully!', 'success');
            }).catch((error) => {
                console.log('Error sharing:', error);
                copyToClipboard();
            });
        } else {
            copyToClipboard();
        }
    }

    function copyToClipboard() {
        navigator.clipboard.writeText(window.location.href).then(() => {
            showIOSNotification('Link copied to clipboard!', 'success');
        }).catch(() => {
            showIOSNotification('Unable to share', 'error');
        });
    }

    // Cart Functions
    async function addToCart() {
        if (!selectedVariant) {
            showIOSNotification('Please select a variant', 'error');
            return;
        }
        
        const itemData = {
            id: productData.id,
            type: 'product',
            quantity: quantity,
            variant_id: selectedVariant.id
        };
        
        const result = await CartAPI.addToCart(itemData);
        
        if (result.success) {
            showIOSNotification(`${quantity} × ${productData.name} added to cart!`, 'success');
            quantity = 1;
            updateQuantityDisplay();
        } else {
            showIOSNotification(result.error || 'Failed to add to cart', 'error');
        }
    }

    async function buyNow() {
        if (!selectedVariant) {
            showIOSNotification('Please select a variant', 'error');
            return;
        }
        
        const itemData = {
            id: productData.id,
            type: 'product',
            quantity: quantity,
            variant_id: selectedVariant.id
        };
        
        const result = await CartAPI.addToCart(itemData);
        
        if (result.success) {
            window.location.href = '{% url "store:cart" %}';
        } else {
            showIOSNotification(result.error || 'Failed to add to cart', 'error');
        }
    }

    // Notification
    function showIOSNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.textContent = message;
        
        let bgColor = 'linear-gradient(135deg, #c46f44 0%, #2c211a 100%)';
        if (type === 'success') bgColor = 'linear-gradient(135deg, #2d8659 0%, #1a5c3e 100%)';
        if (type === 'error') bgColor = 'linear-gradient(135deg, #d9534f 0%, #c9302c 100%)';
        
        notification.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            background: ${bgColor};
            color: white;
            padding: 16px 24px;
            border-radius: 14px;
            font-weight: 600;
            font-size: 14px;
            z-index: 10000;
            animation: slideInRight 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            max-width: 320px;
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s cubic-bezier(0.4, 0, 0.2, 1)';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }

    // Price Update Function
    function updatePriceUI() {
        const priceDisplay = document.getElementById('priceDisplay');
        const meta = document.getElementById('variantMeta');
        const priceValue = selectedVariant ? selectedVariant.price : productData.basePrice;
        
        priceDisplay.textContent = `₹${priceValue}`;
        
        meta.textContent = selectedVariant
            ? `${selectedVariant.ml}ml • Inclusive of all taxes • Free Delivery`
            : 'Inclusive of all taxes • Free Delivery';
    }

    // Variant Selection
    document.querySelectorAll('.variant-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            if (!btn.dataset.variantId) return; // Skip if no variant data
            
            document.querySelectorAll('.variant-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            const variantId = btn.dataset.variantId;
            selectedVariant = productData.variants.find(v => v.id === variantId) || null;
            updatePriceUI();
        });
    });

    // Smooth Scroll for Related Products
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // Intersection Observer for animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all cards for animation
    document.querySelectorAll('.product-header, .rating-section, .price-card, .trust-indicators, .variant-card, .delivery-card, .quantity-card, .highlights-card, .description-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        observer.observe(card);
    });

    // Add animation styles
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOutRight {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(100px);
            }
        }
    `;
    document.head.appendChild(style);

    // Initialize
    updateQuantityDisplay();
    updatePriceUI();

    // Add loading effect
    window.addEventListener('load', () => {
        document.querySelector('.product-gallery').style.animation = 'fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
    });
</script>
{% endblock %}